!function(e,t){"use strict";"function"==typeof define&&define.amd?define(t):e.simpleStorage=t()}(this,function(){"use strict";function n(){window.localStorage.setItem("__simpleStorageInitTest","tmpval"),window.localStorage.removeItem("__simpleStorageInitTest"),o(),f(),s(),"addEventListener"in window&&window.addEventListener("pageshow",function(e){e.persisted&&_()},!1),a=!0}function s(){"addEventListener"in window?window.addEventListener("storage",_,!1):document.attachEvent("onstorage",_)}function _(){try{o()}catch(e){return void(a=!1)}f()}function o(){var e=localStorage.getItem("simpleStorage");try{t=JSON.parse(e)||{}}catch(a){t={}}r=l()}function m(){try{localStorage.setItem("simpleStorage",JSON.stringify(t)),r=l()}catch(e){return e}return!0}function l(){var e=localStorage.getItem("simpleStorage");return e?String(e).length:0}function f(){var e,r,a,n,s,_=1/0,o=0;if(clearTimeout(i),t&&t.__simpleStorage_meta&&t.__simpleStorage_meta.TTL){for(e=+new Date,s=t.__simpleStorage_meta.TTL.keys||[],n=t.__simpleStorage_meta.TTL.expire||{},r=0,a=s.length;a>r;r++){if(!(n[s[r]]<=e)){n[s[r]]<_&&(_=n[s[r]]);break}o++,delete t[s[r]],delete n[s[r]]}1/0!=_&&(i=setTimeout(f,Math.min(_-e,2147483647))),o&&(s.splice(0,o),T(),m())}}function p(e,r){var n,s,a=+new Date,_=!1;if(r=Number(r)||0,0!==r){if(!t.hasOwnProperty(e))return!1;if(t.__simpleStorage_meta||(t.__simpleStorage_meta={}),t.__simpleStorage_meta.TTL||(t.__simpleStorage_meta.TTL={expire:{},keys:[]}),t.__simpleStorage_meta.TTL.expire[e]=a+r,t.__simpleStorage_meta.TTL.expire.hasOwnProperty(e))for(n=0,s=t.__simpleStorage_meta.TTL.keys.length;s>n;n++)t.__simpleStorage_meta.TTL.keys[n]==e&&t.__simpleStorage_meta.TTL.keys.splice(n);for(n=0,s=t.__simpleStorage_meta.TTL.keys.length;s>n;n++)if(t.__simpleStorage_meta.TTL.expire[t.__simpleStorage_meta.TTL.keys[n]]>a+r){t.__simpleStorage_meta.TTL.keys.splice(n,0,e),_=!0;break}_||t.__simpleStorage_meta.TTL.keys.push(e)}else if(t&&t.__simpleStorage_meta&&t.__simpleStorage_meta.TTL){if(t.__simpleStorage_meta.TTL.expire.hasOwnProperty(e))for(delete t.__simpleStorage_meta.TTL.expire[e],n=0,s=t.__simpleStorage_meta.TTL.keys.length;s>n;n++)if(t.__simpleStorage_meta.TTL.keys[n]==e){t.__simpleStorage_meta.TTL.keys.splice(n,1);break}T()}return clearTimeout(i),t&&t.__simpleStorage_meta&&t.__simpleStorage_meta.TTL&&t.__simpleStorage_meta.TTL.keys.length&&(i=setTimeout(f,Math.min(Math.max(t.__simpleStorage_meta.TTL.expire[t.__simpleStorage_meta.TTL.keys[0]]-a,0),2147483647))),!0}function T(){var a,e=!1,r=!1;if(!t||!t.__simpleStorage_meta)return e;t.__simpleStorage_meta.TTL&&!t.__simpleStorage_meta.TTL.keys.length&&(delete t.__simpleStorage_meta.TTL,e=!0);for(a in t.__simpleStorage_meta)if(t.__simpleStorage_meta.hasOwnProperty(a)){r=!0;break}return r||(delete t.__simpleStorage_meta,e=!0),e}var e="0.1.3",t=!1,r=0,a=!1,i=null;try{n()}catch(g){}return{version:e,canUse:function(){return!!a},set:function(e,r,a){if("__simpleStorage_meta"==e)return!1;if(!t)return!1;if("undefined"==typeof r)return this.deleteKey(e);a=a||{};try{r=JSON.parse(JSON.stringify(r))}catch(i){return i}return t[e]=r,p(e,a.TTL||0),m()},get:function(e){return t?t.hasOwnProperty(e)&&"__simpleStorage_meta"!=e&&this.getTTL(e)?t[e]:void 0:!1},deleteKey:function(e){return t&&e in t?(delete t[e],p(e,0),m()):!1},setTTL:function(e,r){return t?(p(e,r),m()):!1},getTTL:function(e){var r;return t&&t.hasOwnProperty(e)?t.__simpleStorage_meta&&t.__simpleStorage_meta.TTL&&t.__simpleStorage_meta.TTL.expire&&t.__simpleStorage_meta.TTL.expire.hasOwnProperty(e)?(r=Math.max(t.__simpleStorage_meta.TTL.expire[e]-+new Date||0,0),r||!1):1/0:!1},flush:function(){if(!t)return!1;t={};try{return localStorage.removeItem("simpleStorage"),!0}catch(e){return e}},index:function(){if(!t)return!1;var r,e=[];for(r in t)t.hasOwnProperty(r)&&"__simpleStorage_meta"!=r&&e.push(r);return e},storageSize:function(){return r}}});