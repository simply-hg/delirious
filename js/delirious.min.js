"use strict";function now(){return Math.round(+new Date/1e3)}function dbgMsg(){return!0}function checkpoint(){return!0}function escapeString(e){return e=_.escape(e),e=e.split("&amp;amp;").join("&amp;"),e=e.split("&amp;quot;").join("&quot;"),e=e.split("&amp;rsquo;").join("&rsquo;"),e=e.split("&amp;lsquo;").join("&lsquo;"),e=e.split("&amp;lsaquo;").join("&lsaquo;"),e=e.split("&amp;rsaquo;").join("&rsaquo;"),e=e.split("&amp;euro;").join("&euro;"),e=e.split("&amp;nbsp;").join("&nbsp;"),e=e.split("&amp;shy;").join("&shy;")}function getNumber(e){var t=$.type(e);return"number"===t?e:"string"===t?parseInt(e,10):void 0}function getBool(e){switch(e){case!0:case"true":case"on":case"ja":case"yes":return!0;default:return!1}}function getString(e){var t=$.type(e);return"number"===t?e.toString():"string"===t?e:""}function sortHelper(e,t){var a=e.title.toLowerCase(),i=t.title.toLowerCase();return i>a?-1:a>i?1:0}function renderDate(e,t){var a=(new Date,new Date(1e3*t)),i=a.getMonth()+1,n=a.getMinutes();return 10>n&&(n="0"+n),"long"===e?a.getDate()+"."+i+"."+a.getFullYear()+" @ "+a.getHours()+":"+n:"date"===e?a.getDate()+"."+i+"."+a.getFullYear():"time"===e?a.getHours()+":"+n:"relative-date"===e?"":"relative-time"===e?"":void 0}function getCurrentPageID(){return $(":mobile-pagecontainer").pagecontainer("getActivePage").attr("id")}function exportSettings(){}function importSettings(){}function getStorageKey(e,t){if(simpleStorage.canUse()){var a=simpleStorage.index();_.has(a,e);var i=simpleStorage.get(e);return dbgMsg("getStorageKey("+e+")"),_.isUndefined(i)?(dbgMsg("return default_value"),t):i}return t}function getSettings(){dm_config=getStorageKey("dm-config",dm_config),dm_data=getStorageKey("dm-data",dm_data),dbgMsg(dm_config),dm_key=getOption("key"),dm_url=getOption("url"),dm_user=getOption("user"),transition=getOption("transition"),feeds_hash=getStorageKey("dm-feed-hash",feeds_hash),feed_counter=getStorageKey("dm-feed-counter",feed_counter),favicons=getStorageKey("dm-favicons",favicons);var e=getStorageKey("dm-saved-items","");return saved_items=""===e?[]:JSON.parse(LZString.decompressFromUTF16(e)),widgets=getStorageKey("dm-widgets",default_widgets),fav_feeds=getStorageKey("dm-fav-feeds",[]),fav_groups=getStorageKey("dm-fav-groups",[]),$.mobile.defaultPageTransition=transition,!0}function getFever(e){return getOption("url")+"?api"+e}function getURL(){return getOption("url")}function getOption(e){return _.has(dm_config,e)?dm_config[e]:(dbgMsg("Get Config unbekannt: "+e),-1)}function saveOptions(){var e=simpleStorage.set("dm-config",dm_config);dbgMsg(e)}function setOption(e,t){return _.has(dm_config,e)?(dbgMsg("Has option: "+e),dm_config[e]=t,saveOptions(),void 0):(dbgMsg("Set Config unbekannt: "+e),-1)}function start(){dbgMsg("start"),""===dm_url?(dbgMsg("No URL. Login"),$.mobile.navigate("#page-login")):(started_items_load=!0,showHideLoader("start"),$.post(dm_url+"?api",{api_key:dm_key}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)&&(auth_success=!0,syncGroups(),syncFeeds(),syncUnreadItems("full"),syncSavedItems("start"),dm_autosync=window.setInterval("autoSync()",3e5),prepareHome())}).fail(function(){showHideLoader("stop"),checkAuth(0)}))}function initSettings(){dbgMsg(dm_config),""!==dm_url&&$("#dm-fever-url").val(dm_url),""!==dm_user&&$("#dm-e-mail").val(dm_user),$('input:radio[name="dm-setting-transitions"]').filter('[value="'+getOption("transition")+'"]').prop("checked",!0),$('input:radio[name="dm-setting-groupview"]').filter('[value="'+getOption("groupview")+'"]').prop("checked",!0),$('input:radio[name="dm-setting-empty-groups"]').filter('[value="'+getOption("show_empty_groups")+'"]').prop("checked",!0),$('input:radio[name="dm-setting-sharing"]').filter('[value="'+getOption("sharing")+'"]').prop("checked",!0),$('input:radio[name="dm-setting-order"]').filter('[value="'+getOption("order_items")+'"]').prop("checked",!0),$('input:radio[name="dm-setting-paginate-items"]').filter('[value="'+getOption("paginate_items")+'"]').prop("checked",!0),$("#dm-setting-sharing-msg").val(getOption("sharing_msg")),$("#dm-setting-sharing-mobile").prop("checked",getOption("sharing_mobile")),$('input:radio[name="dm-setting-widget-recent-items-count"]').filter('[value="'+getOption("widget_recent_items")+'"]').prop("checked",!0),$('input:radio[name="dm-setting-html-content"]').filter('[value="'+getOption("html_content")+'"]').prop("checked",!0)}function saveSettings(){var e,t,a,i,n;return setOption("html_content",$("input[name=dm-setting-html-content]:checked").val()),setOption("sharing_mobile",getBool($("#dm-setting-sharing-mobile").is(":checked"))),setOption("widget_recent_items",getNumber($("input[name=dm-setting-widget-recent-items-count]:checked").val())),setOption("transition",$("input[name=dm-setting-transitions]:checked").val()),setOption("groupview",$("input[name=dm-setting-groupview]:checked").val()),setOption("show_empty_groups",getBool($("input[name=dm-setting-empty-groups]:checked").val())),setOption("sharing",$("input[name=dm-setting-sharing]:checked").val()),setOption("sharing_msg",$("#dm-setting-sharing-msg").val()),setOption("order_items",$("input[name=dm-setting-order]:checked").val()),setOption("paginate_items",getNumber($("input[name=dm-setting-paginate-items]:checked").val())),e=$.trim($("#dm-fever-url").val()),t=$.trim($("#dm-e-mail").val()),a=$.trim($("#dm-password").val()),$("#dm-password").val(""),""!=a?(n=MD5(t+":"+a),a="",setOption("url",$.trim($("#dm-fever-url").val())),setOption("user",$.trim($("#dm-e-mail").val())),setOption("key",n),auth_success=!1,saveOptions(),$.post(e+"?api",{api_key:n}).done(function(a){1===a.auth?(auth_success=!0,setOption("url",e),setOption("key",n),setOption("user",t),saveOptions(),storeLoadedSavedItems(),restart(),$.mobile.navigate("#page-home",{transition:i})):alert("Wrong credentials. Please try again.")}).fail(function(){checkAuth(0)}),!1):(saveOptions(),getSettings(),runAfterItemLoadNoHome(),storeLoadedSavedItems(),$.mobile.navigate("#page-home",{transition:i}),!1)}function restart(){getSettings(),start()}function login(){var e=$.trim($("#dm-login-url").val()),t=$.trim($("#dm-login-e-mail").val()),a=$.trim($("#dm-login-password").val()),i=MD5(t+":"+a);$.post(e+"?api",{api_key:i}).done(function(a){dbgMsg(a),1==a.auth?(dbgMsg("login()"),auth_success=!0,dbgMsg(dm_config),setOption("url",e),setOption("key",i),setOption("user",t),dbgMsg(dm_config),$("#dm-login-url").val(""),$("#dm-login-e-mail").val(""),$("#dm-login-password").val(""),getSettings(),start(),$.mobile.navigate("#page-home",{transition:transition})):alert("Wrong credentials. Please try again.")}).fail(function(){checkAuth(0)})}function logout(){simpleStorage.flush(),dm_key="",dm_url="",dm_user="",favicons="",dm_config={},dm_data={},items=[],saved_items=[],session_read_items=[],auth_success=!1,start()}function showSaved(){$("#dm-select-saved-time").removeClass("ui-btn-active"),$("#dm-select-saved-time").addClass("ui-btn-active"),showSavedByTimePage(1)}function showSavedByTime(){return showSavedByTimePage(1),!1}function showSavedByTimePage(e){checkpoint("showSavedByTimePage()"),$("#dm-saved-content").empty();var t="Saved Items ("+saved_items.length+")";if($("#page-saved").data("title",t),$("#dm-saved-header").html(t),document.title=t,saved_items.length>0){var a="";if(0!==getOption("paginate_items")){checkpoint("page saved items");var i=Math.ceil(saved_items.length/getOption("paginate_items")),n=Math.min(getOption("paginate_items")*e-1,saved_items.length-1),s=getOption("paginate_items")*(e-1);dbgMsg("Pages: "+i+", Upper: "+n+", Lower:"+s);for(var d=s;n>=d;d++)a+=renderListviewItem(saved_items[d],!0,!0,"long");for(var r="",o="",m="",u=1;i>=u;u++){var c="";u===getNumber(e)&&(c=" ui-btn-active"),r+='<a href="" data-role="button" data-dm-fnc="show-saved-page" data-dm-saved-page="'+u+'" class="ui-btn ui-corner-all ui-btn-inline dm-button'+c+'">&nbsp;'+u+"&nbsp;</a>"}if(e!==i){var g=getNumber(e)+1;o='<a href="" data-role="button" data-dm-fnc="show-saved-page" data-dm-saved-page="'+g+'" class="ui-btn ui-icon-arrow-r ui-btn-icon-right ui-corner-all ui-btn-inline dm-button">Next</a>'}else o='<a href="" data-role="button" data-dm-fnc="show-saved-page" class="ui-btn ui-corner-all ui-icon-arrow-r ui-btn-icon-right ui-btn-inline ui-state-disabled">Next</a>';if(1!==e){var l=getNumber(e)-1;m='<a href="" data-role="button" data-dm-fnc="show-saved-page" data-dm-saved-page="'+l+'" class="ui-btn ui-icon-arrow-l ui-btn-icon-left ui-corner-all ui-btn-inline dm-button">Last</a>'}else m='<a href="" data-role="button" data-dm-fnc="show-saved-page" class="ui-btn ui-icon-arrow-l ui-btn-icon-left ui-corner-all ui-btn-inline ui-state-disabled">Last</a>';$("#dm-saved-content").append(m+r+o),$("#dm-saved-content").append('<ul id="dm-saved-view" data-role="listview" data-divider-theme="a" data-inset="true" data-filter="true">'+a+"</ul>"),$("#dm-saved-content").append(m+r+o)}else $.each(saved_items,function(e,t){a+=renderListviewItem(t,!0,!0,"long")}),$("#dm-saved-content").append('<ul id="dm-saved-view" data-role="listview" data-divider-theme="a" data-inset="true" data-filter="true">'+a+"</ul>")}return!1}function showSavedByFeed(){var e,t;$("#dm-saved-content").empty();var a="Saved Items ("+saved_items.length+")";return $("#page-saved").data("title",a),document.title=a,$("#dm-saved-header").html(a),saved_items.length>0&&(e=_.groupBy(saved_items,"feed_id"),t=_.keys(e),$.each(feeds,function(e,a){if(_.contains(t,getString(a.id))){dbgMsg(a.title);var i="<h2>"+escapeString(a.title)+"</h2>",n=_.filter(saved_items,function(e){return getNumber(e.feed_id)===getNumber(a.id)?!0:!1});dbgMsg(n),i+='<ul data-role="listview" data-divider-theme="a" data-inset="true">',$.each(n,function(e,t){i+=renderListviewItem(t,!0,!0,"long")}),i+="</ul>",$("#dm-saved-content").append(i)}})),!1}function showHot(e){if(1==e)$("#dm-hot-content").empty();else{var t=e;t++}var a=$("#dm-hot-range option:selected").val(),i=$("#dm-hot-offset option:selected").val();showHideLoader("start"),$.post(dm_url+"?api&links&offset="+i+"&range="+a+"&page="+e,{api_key:dm_key}).done(function(t){if(showHideLoader("stop"),checkAuth(t.auth)){var a="";$.each(t.links,function(e,t){var i="",n="";a+=t.item_ids+",",i+="<div>",i+="<h2>",i+=_.escape(t.temperature)+'<span style="color:red">°</span>&nbsp;',1==t.is_local&&1==t.is_item?(a+=t.item_id+",",i+='<a href="" class="dm-link-'+t.item_id+' dm-hot-links dm-button" data-dm-fnc="show-item" data-dm-show-item="'+_.escape(t.item_id)+'">'+escapeString(t.title)+"</a>"):i+='<a href="'+t.url+'" class="dm-hot-links" target="_blank">'+escapeString(t.title)+"</a>",i+="</h2>",1==t.is_local&&1==t.is_item&&(i+='<p style="max-height:2.8em;overflow:hidden;" class="dm-link-'+_.escape(t.item_id)+'-content"></p>',i+='<p style="text-align:right;">posted by <span class="dm-link-'+_.escape(t.item_id)+'-favicon"></span> ',i+='<span class="dm-link-'+_.escape(t.item_id)+'-feedname dm-hot-links">Feed</span></p>',i+='<p style="text-align:right;">',i+='<a href="'+_.escape(t.url)+'" target="_blank" data-role="button" data-theme="a" data-inline="true" data-mini="true" data-icon="grid">Open URL</a> ',i+='<a href="" data-dm-fnc="toggle-save-item" data-dm-save-item-id="'+_.escape(t.item_id)+'" data-role="button" data-icon="plus" data-theme="a" data-inline="true" data-mini="true" class="dm-button dm-link-'+_.escape(t.item_id)+'-save-button">Save</a></p>'),i+='<ul data-role="listview" data-theme="a" data-inset="true" id="dm-hot-content-link-'+_.escape(t.id)+'" class="dm-hot-linkbox">';for(var s,d=t.item_ids.split(","),r=0;s=d[r];r++)s=_.escape(s),i+='<li class="ui-li-has-icon"><span class="dm-link-'+s+'-favicon"></span><p>',i+='<a href="" class="dm-link-'+s+" dm-button dm-hot-links dm-single-item-link-"+s+'" data-dm-show-item="'+_.escape(s)+'" data-dm-fnc="show-item">',i+='<span class="dm-link-'+s+"-title dm-hot-links dm-single-item-link-"+s+'">Link: '+s+"</span>",i+="</a> ",i+='by <span class="dm-link-'+s+'-feedname dm-hot-links">Feed</span></p></li>',n+=s+",";i+="</ul>",i+='<div style="text-align:right">',i+='<a href="" data-role="button" data-theme="a" data-inline="true" data-mini="true" data-icon="check" class="dm-button" data-dm-fnc="mark-items-read" data-dm-item-ids="'+_.escape(n)+'">Mark Links as read</a>',i+="</div>",i+="</div>",$("#dm-hot-content").append(i)});var i=a.split(",");return i=_.compact(i),$.each(i,function(e,t){var a=_.findWhere(items,{id:parseInt(t,10)});if(a||(a=_.findWhere(session_read_items,{id:parseInt(t,10)})),a){var n=t;i=_.filter(i,function(e){return e==n?!1:!0}),replacePlaceholder(a)}}),fillLinkPlaceholder(i,"link"),1==e?!1:!1}}).fail(function(){showHideLoader("stop"),checkAuth(0)})}function fillLinkPlaceholder(e,t){if(e.length>40)var a=_.first(e,40),i=_.rest(e,40);else var a=e,i=[];var n=a.join(",");showHideLoader("start"),$.post(dm_url+"?api&items&with_ids="+_.escape(n),{api_key:dm_key}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)&&$.each(e.items,function(e,t){session_read_items.push(t),replacePlaceholder(t)})}).fail(function(){showHideLoader("stop"),checkAuth(0)}),i.length>0?fillLinkPlaceholder(i,t):$("#page-hot").enhanceWithin()}function replacePlaceholder(e){var t="link",a="dm-is-read";"raw"===getOption("html_content")?($(".dm-"+t+"-"+e.id+"-title").html($.parseHTML(e.title)),$(".dm-"+t+"-"+e.id+"-content").html(escapeString(e.html))):($(".dm-"+t+"-"+e.id+"-title").html(escapeString(e.title)),$(".dm-"+t+"-"+e.id+"-content").html(escapeString(e.html))),0==e.is_read?($(".dm-"+t+"-"+e.id+"-title").addClass("dm-item-is-unread"),a="dm-is-unread"):$(".dm-"+t+"-"+e.id+"-title").addClass("dm-item-is-read");var i=_.findWhere(feeds,{id:e.feed_id});$(".dm-"+t+"-"+e.id+"-feedname").html('<a href="" class="dm-button '+a+'" data-dm-fnc="show-feed" data-dm-show-feed="'+_.escape(i.id)+'">'+escapeString(i.title)+"</a>"),1==e.is_saved?(dbgMsg("saved"),$(".dm-link-"+_.escape(e.id)+"-save-button").text("Unsave"),$(".dm-link-"+_.escape(e.id)+"-save-button").buttonMarkup({icon:"minus"})):(dbgMsg("unsaved"),$(".dm-link-"+_.escape(e.id)+"-save-button").text("Save"),$(".dm-link-"+_.escape(e.id)+"-save-button").buttonMarkup({icon:"plus"}));var n=getFavicon(i,"ui-li-icon dm-favicon");return $(".dm-"+t+"-"+e.id+"-favicon").before(n).removeClass("dm-"+t+"-"+e.id+"-favicon"),!0}function buildGroup(e){last_dm_group_show=now(),e=getNumber(e),$("#dm-group-content").empty(),$("#dm-group-more").empty(),$("#dm-group-content").append('<div style="margin-bottom:1em;"><a href="" data-role="button" data-dm-fnc="show-feeds-group" data-dm-group-id="'+e+'" id="dm-group-show-feeds" class="dm-button">Show Feeds of Group</a></div>'),$("#dm-group-content").append('<ul data-role="listview" data-divider-theme="a" data-inset="true" data-filter="true" id="dm-group-view"></ul>');var t=_.findWhere(groups,{id:e}),a=_.findWhere(feeds_groups,{group_id:e}),i=[];i=_.map(a.feed_ids.split(","),function(e){return getNumber(e)});var n=_.filter(items,function(e){return-1!==$.inArray(e.feed_id,i)&&0==e.is_read?!0:!1}),s=n.length,d="";dbgMsg(getOption("paginate_items")),0===getNumber(getOption("paginate_items"))||getNumber(getOption("paginate_items"))>=s?(dbgMsg("check all"),$.each(n,function(e,t){var a="";a+=renderListviewItem(t,!0,!0,"long"),d+=t.id+",",$("#dm-group-view").append(a)}),$("#dm-group-more").append('<button class="dm-button" data-dm-fnc="mark-group-read" data-dm-group-id="'+e+'" data-dm-item-ids="'+d+'">Mark Items Read</button>'),$("#dm-group-read").data("dm-fnc","mark-group-read"),$("#dm-group-read").data("dm-group-id",e),$("#dm-group-read").data("dm-item-ids",d)):(dbgMsg("check paginate"),$.each(_.first(n,getNumber(getOption("paginate_items"))),function(e,t){var a="";a+=renderListviewItem(t,!0,!0,"long"),d+=t.id+",",$("#dm-group-view").append(a)}),$("#dm-group-more").append('<button class="dm-button" data-dm-fnc="show-group-more" data-dm-group-id="'+e+'" data-dm-item-ids="'+d+'">Show More</button>'),$("#dm-group-read").data("dm-fnc","show-group-more"),$("#dm-group-read").data("dm-item-ids",d),$("#dm-group-read").data("dm-group-id",e));var r=t.title+" ("+s+")";$("#page-group").data("title",r),$("#dm-group-header").html(escapeString(r)),document.title=r,$("#dm-group-content").data("dm-current-ids",d),$("#dm-group-content").data("dm-current-group-id",e),$("#dm-mark-group-read").data("dm-item-ids",d),$("#dm-mark-group-read").data("fdm-group-id",e)}function showGroup(e){return $("#dm-group-content").removeData("dm-current-ids"),$("#dm-group-content").removeData("dm-current-group-id"),buildGroup(e),$("#dm-group-favmarker").data("dm-group-id",e),$("#dm-mark-group-read").data("dm-group-id",e),$("#dm-group-favmarker").html(_.contains(fav_groups,e)?"Remove Group from Favourites":"Mark Group as Favourite"),!1}function buildFeed(e){last_dm_group_show=now(),e=getNumber(e),$("#dm-feed-content").empty(),$("#dm-feed-more").empty(),$("#dm-feed-content").append('<ul data-role="listview" data-divider-theme="a" data-inset="true" data-filter="true" id="dm-feed-view"></ul>');var t=_.where(items,{feed_id:e}),a=_.findWhere(feeds,{id:e}),i=t.length,n="";0===getNumber(getOption("paginate_items"))||getNumber(getOption("paginate_items"))>=i?(dbgMsg("check all"),$.each(t,function(e,t){var a="";a+=renderListviewItem(t,!1,!0,"long"),n+=t.id+",",$("#dm-feed-view").append(a)}),$("#dm-feed-more").append('<button class="dm-button" data-dm-fnc="mark-feed-read" data-dm-feed-id="'+e+'" data-dm-item-ids="'+n+'">Mark Items Read</button>'),$("#dm-feed-read").data("dm-fnc","mark-feed-read"),$("#dm-feed-read").data("dm-feed-id",e),$("#dm-feed-read").data("dm-item-ids",n)):(dbgMsg("check paginate"),$.each(_.first(t,getNumber(getOption("paginate_items"))),function(e,t){var a="";a+=renderListviewItem(t,!0,!0,"long"),n+=t.id+",",$("#dm-feed-view").append(a)}),$("#dm-feed-more").append('<button class="dm-button" data-dm-fnc="show-feed-more" data-dm-feed-id="'+e+'" data-dm-item-ids="'+n+'">Show More</button>'),$("#dm-feed-read").data("dm-fnc","show-feed-more"),$("#dm-feed-read").data("dm-item-ids",n),$("#dm-feed-read").data("dm-feed-id",e));var s=a.title+" ("+i+")";$("#page-feed").data("title",s),$("#dm-feed-header").html(escapeString(s)),document.title=s,$("#dm-feed-content").data("dm-feed-item-ids",n),$("#dm-feed-content").data("dm-feed-id",e),$("#dm-feed-content").data("dm-current-ids",n),$("#dm-feed-content").data("dm-current-feed-id",e),$("#dm-mark-feed-read").data("dm-item-ids",n),$("#dm-mark-feed-read").data("dm-feed-id",e)}function showFeed(e){return e=getNumber(e),$("#dm-feed-content").removeData("dm-feed-item-ids"),$("#dm-feed-content").removeData("dm-feed-id"),buildFeed(e),$("#dm-feed-favmarker").html(_.contains(fav_feeds,e)?"Remove Feed from Favourites":"Mark Feed as Favourite"),!1}function showSingleItem(e){var t=_.findWhere(items,{id:getNumber(e)});return t||(t=_.findWhere(session_read_items,{id:e})),t?renderSingleItem(t):(showHideLoader("start"),$.post(dm_url+"?api&items&with_ids="+_.escape(e),{api_key:dm_key}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)&&(session_read_items.push(e.items[0]),renderSingleItem(e.items[0]))}).fail(function(){showHideLoader("stop"),checkAuth(0)})),!1}function renderSingleItem(e){if($("#dm-single-content").empty(),"raw"===getOption("html_content")){try{var t=$.parseHTML(e.html);$(t).find("img").removeAttr("onerror"),$(t).find("img").removeAttr("onload"),$("#dm-single-content").append(t)}catch(a){dbgMsg("error in html of item");var t=escapeString(e.html);t=t.split("\n").join("<br>"),$("#dm-single-content").html(t)}$("#dm-single-content a").attr("target","_blank"),$("#dm-single-content img").attr("height",""),$("#dm-single-content img").attr("width",""),$("#dm-single-content").fitVids()}else{var t=escapeString(e.html);t=t.split("\n").join("<br>"),$("#dm-single-content").html(t)}$("#dm-single-title").html(escapeString(e.title)),$("#dm-single-title").attr("href",e.url),$("#page-single").data("title",_.escape(e.title)),$("#dm-single-url").attr("href",e.url);var i="";e.author&&(i+="by "+e.author+" "),i+="on "+renderDate("long",e.created_on_time),$("#dm-single-meta").html(escapeString(i));var n=_.findWhere(feeds,{id:e.feed_id});$("#dm-single-feed-title").html(escapeString(n.title)),$("#page-single").data("title",_.escape(n.title));var s=getFavicon(n);if($("#dm-single-feedname").html(s+_.escape(n.title)),$("#dm-single-feedname").data("dm-show-feed",e.feed_id),$("#dm-single-btn-save").data("dm-save-item-id",e.id),markItemsRead(e.id.toString()),1===e.is_saved?($("#dm-single-btn-save").text("Unsave"),$("#dm-single-btn-save").buttonMarkup({icon:"minus"})):($("#dm-single-btn-save").text("Save"),$("#dm-single-btn-save").buttonMarkup({icon:"plus"})),$("#dm-single-sharing-buttons").empty(),"all"===getOption("sharing")){var d='<iframe src="//www.facebook.com/plugins/like.php?href='+encodeURI(e.url)+'&amp;send=false&amp;layout=box_count&amp;width=100&amp;show_faces=false&amp;font&amp;colorscheme=light&amp;action=like&amp;height=90" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:100px; height:90px;" allowTransparency="true"></iframe>',r='<a href="https://twitter.com/share" class="twitter-share-button" data-size="medium" data-count="vertical" data-url="'+encodeURI(e.url)+'">Tweet</a>';r+='<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>';var o='<div class="g-plusone" data-size="tall" data-href="'+encodeURI(e.url)+'"></div>';o+='<script type="text/javascript">',o+="(function() {",o+="var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;",o+="po.src = 'https://apis.google.com/js/plusone.js';",o+="var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);",o+="})();",o+="</script>";try{$("#dm-single-sharing-buttons").append(d)}catch(a){dbgMsg("fb button caused an error...")}try{$("#dm-single-sharing-buttons").append(r)}catch(a){dbgMsg("twitter button caused an error...")}try{$("#dm-single-sharing-buttons").append(o)}catch(a){dbgMsg("g+ button caused an error...")}}if("all"===getOption("sharing")||"email"===getOption("sharing")){var m=getOption("sharing_msg").split("%url%").join(e.url),u='<a href="mailto:?subject='+encodeURI("Check it out: "+e.title)+"&amp;body="+encodeURI(m)+'" data-role="button">Share Link by E-Mail</a>';$("#dm-single-sharing-buttons").append(u)}if("all"===getOption("sharing")||"email"===getOption("sharing")){var c='<div data-role="navbar"><ul>';c+='<li><a href="http://www.facebook.com/sharer/sharer.php?u='+encodeURI(e.url)+'" target="_blank">Facebook</a></li>',c+='<li><a href="https://twitter.com/intent/tweet?text=Look&url='+encodeURI(e.url)+'" target="_blank">Twitter</a></li>',c+='<li><a href="https://plus.google.com/share?url='+encodeURI(e.url)+'" target="_blank">Google+</a></li>',c+="</ul></div>",getOption("sharing_mobile")&&(dbgMsg("mobile Sharing: "+getOption("sharing_mobile")),c+='<div data-role="navbar"><ul>',c+='<li><a href="whatsapp://send?text='+encodeURI(e.title+" - "+e.url)+'">WhatsApp</a></li>',c+='<li><a href="threema://compose?text='+encodeURI(e.title+" - "+e.url)+'">Threema</a></li>',c+="</ul></div>"),$("#dm-single-passive-sharing-buttons").empty(),$("#dm-single-passive-sharing-buttons").append(c)}if("all"===getOption("sharing"))try{twttr.widgets.load()}catch(a){dbgMsg("twitter object seems to be missing...")}return $("#page-single").enhanceWithin(),!1}function getUnreadSparks(){var e=_.where(feeds,{is_spark:1}),t=[];$.each(e,function(e,a){t.push(a.id)});var a=0,i=[];$.each(items,function(e,n){1==$.inArray(n.feed_id,t)&&0==n.is_read&&(a++,i.push(n))});var n={items:i,counter:a};return n}function showSparks(){last_dm_group_show=now(),$("#dm-sparks-content").empty(),$("#dm-sparks-content").append('<ul data-role="listview" data-divider-theme="a" data-inset="true" id="dm-sparks-view"></ul>');var e=getUnreadSparks(),t="";return $.each(e.items,function(e,a){if(0==a.is_read){var i="";i+=renderListviewItem(a,!0,!0,"long"),t+=a.id+",",$("#dm-sparks-view").append(i)}}),$("#dm-sparks").data("dm-current-ids",t),$.mobile.navigate("#page-sparks",{transition:transition}),!1}function showAllFeeds(){return buildAllFeeds(),!1}function buildAllFeeds(){$("#dm-all-feeds-content").empty(),$("#dm-all-feeds-content").append('<ul data-role="listview" data-divider-theme="a" data-inset="true" data-filter="true" id="dm-all-feeds-view"></ul>'),countUnreadItems(),$.each(feeds,function(e,t){var a=renderListviewItemFeed(t,!0);$("#dm-all-feeds-view").append(a)});var e="All Feeds ("+feeds.length+")";return $("#page-all-feeds").data("title",e),$("#dm-all-feeds-title").html(e),!1}function showHideLoader(e){"start"==e?loading++:loading--,0==loading&&($.mobile.loading("hide"),prepareHome()),1==loading&&"start"==e&&$.mobile.loading("show",{text:"Synchronizing data...",textVisible:!0,theme:"a"})}function buildKindling(){last_dm_group_show=now(),$("#dm-kindling-content").empty(),$("#dm-kindling-content").append('<ul data-role="listview" data-divider-theme="a" data-inset="true" data-filter="true" id="dm-kindling-view"></ul>'),$("#dm-kindling-more").empty();var e="";if(dbgMsg("check2"),0===getOption("paginate_items"))$.each(items,function(t,a){if(0==a.is_read){var i=renderListviewItem(a,!0,!0,"long");$("#dm-kindling-view").append(i),e+=i.id+","}});else{var t=_.first(items,getNumber(getOption("paginate_items")));if(dbgMsg(t.length),$.each(t,function(t,a){if(0==a.is_read){var i=renderListviewItem(a,!0,!0,"long");$("#dm-kindling-view").append(i),e+=a.id+","}}),items.length>getNumber(getOption("paginate_items"))){var a="Show More";$("#dm-kindling-more").append('<button data-dm-fnc="show-kindling-more" class="dm-button" data-dm-ids="'+e+'">'+a+"</button>")}else{var a="Mark as Read";$("#dm-kindling-more").append('<button data-dm-fnc="mark-kindling-read" class="dm-button" data-dm-ids="'+e+'">'+a+"</button>")}$("#dm-kindling-items").data("dm-ids",e)}return $("#dm-kindling-header").html('Fever<span style="color:red">°</span> Kindling Items ('+items.length+")"),document.title="Fever° Kindling Items ("+items.length+")",$("#page-kindling").data("title","Fever° Kindling Items ("+items.length+")"),!0}function showKindling(){return dbgMsg("check"),buildKindling(),!1}function getFavicon(e,t){if(e){if(t);else var t="dm-favicon";var a=_.findWhere(favicons,{id:e.favicon_id});if(a&&1!=a.id)return'<img src="data:'+a.data+'" height="16" width="16" class="'+t+'"/>'}return'<img src="artwork/feed-icon-generic.png" height="16" width="16" class="'+t+'"/>'}function showGroupSelector(e){return"feeds"==getOption("groupview")?showFeedsInGroup(e):showGroup(e),!1}function showFeedsInGroup(e){last_dm_group_show=now(),$("#dm-feedgroup-content").empty(),$("#dm-feedgroup-content").append('<div style="margin-bottom:1em;"><a href="" data-role="button" data-dm-show-group="'+e+'" class="dm-button" data-dm-fnc="show-group" id="dm-feedgroup-show-all">Show All Items</a></div>'),$("#dm-feedgroup-content").append('<ul data-role="listview" data-divider-theme="a" data-inset="true" data-filter="true" id="dm-feedgroup-view"></ul>');var t=_.findWhere(groups,{id:getNumber(e)}),a=countUnreadInGroup(e),i=escapeString(t.title+" ("+a+")");$("#page-feedgroup").data("title",i),$("#dm-feedgroup-header").html(i);var n,s=_.findWhere(feeds_groups,{group_id:e}),d=_.compact(s.feed_ids.split(",")),r=[];for(n in d)r.push(_.findWhere(feeds,{id:getNumber(d[n])}));return r.sort(function(e,t){var a=e.title.toLowerCase(),i=t.title.toLowerCase();return i>a?-1:a>i?1:0}),countUnreadItems(),$.each(r,function(e,t){var a=renderListviewItemFeed(t,!1);a&&$("#dm-feedgroup-view").append(a)}),!1}function renderListviewItemFeed(e,t){if(_.isUndefined(e))return"";var a=getNumber(getUnreadCountFeed(e.id));if(0===a&&getOption("show_empty_groups")===!1&&t===!1)return"";var i="";return i+="<li>",i+='<a class="dm-button" data-dm-fnc="show-feed" data-dm-show-feed="'+_.escape(e.id)+'">',i+=getFavicon(e,"ui-li-icon dm-favicon dm-favicon-feed"),i+=escapeString(e.title)+'<span class="ui-li-count">'+a+"</span></a>",i+="</li>"}function renderListviewItem(e,t,a,i){var n,s;n="<li>";var d=_.findWhere(feeds,{id:e.feed_id});return d?(n+=getFavicon(d,"dm-favicon ui-li-icon"),n+='<p class="dm-listview-content">',s=0==e.is_read?"dm-item-is-unread":"dm-item-is-read",n+='<a href="" class="dm-button dm-hot-links dm-single-item-link-'+_.escape(e.id)+" "+s+'" data-dm-show-item="'+_.escape(e.id)+'" data-dm-fnc="show-item">'+escapeString(e.title)+'</a></p><p class="dm-listview-content">posted',1==t&&(n+=' on <a href="" class="dm-hot-links dm-is-read dm-button" data-dm-fnc="show-feed" data-dm-show-feed="'+_.escape(d.id)+'">'+escapeString(d.title)+"</a>"),1==a&&e.author&&(n+=" by "+escapeString(e.author)),i&&(n+=" at "+renderDate(i,e.created_on_time)),n+="</p>",n+="</li>"):""}function prepareHome(){var curr_page=$(":mobile-pagecontainer").pagecontainer("getActivePage").attr("id");switch(dbgMsg("preparing home"),curr_page){case"page-home":$.each(widgets,function(index,value){$("#dm-widget-place-"+value.place).html(eval(value.fnc))}),document.title="Delirious° ("+items.length+")",$("#dm-header").html('Delirious<span style="color:red">°</span> ('+items.length+")"),$("#page-home").enhanceWithin()}}function showHome(){return $.mobile.navigate("#page-home",{transition:transition}),!1}function showGroups(){return $("#dm-groups-content").empty(),$("#dm-groups-content").append(widgetSystemGroups()),$("#dm-groups-content").append(widgetCustomGroups()),!1}function markFeedAsFav(){var e=$("#dm-feed-content").data("dm-feed-id");if(dbgMsg("markFeedAsFav()"),_.contains(fav_feeds,e)){fav_feeds=_.without(fav_feeds,e),dbgMsg("Remove feed from fav "+e);var t=simpleStorage.set("dm-fav-feeds",_.compact(fav_feeds));dbgMsg(t),$("#dm-feed-favmarker").html("Mark Feed as Favourite")}else{fav_feeds.push(e),dbgMsg("add feed to fav "+e);var t=simpleStorage.set("dm-fav-feeds",_.compact(fav_feeds));dbgMsg(t),$("#dm-feed-favmarker").html("Remove Feed from Favourites")}return!1}function markGroupAsFav(){var e=$("#dm-group-content").data("dm-current-group-id");return _.contains(fav_groups,e)?(fav_groups=_.without(fav_groups,e),simpleStorage.set("dm-fav-groups",_.compact(fav_groups)),$("#dm-group-favmarker").html("Mark Group as Favourite")):(fav_groups.push(e),simpleStorage.set("dm-fav-groups",_.compact(fav_groups)),$("#dm-group-favmarker").html("Remove Group from Favourites")),!1}function countUnreadInGroup(e){var t=(_.findWhere(groups,{id:e}),_.findWhere(feeds_groups,{group_id:e}));if(_.isUndefined(t))return 0;var a=t.feed_ids.split(","),i=[];$.each(a,function(e,t){i.push(parseInt(t,10))});var n=0;return $.each(items,function(e,t){-1!==$.inArray(t.feed_id,i)&&0==t.is_read&&n++}),n}function showEditHomescreen(){var e='<option value="widgetEmpty">None</option>';return defined_widgets=_.sortBy(defined_widgets,"title"),$.each(defined_widgets,function(t,a){e+='<option value="'+a.fnc+'">'+a.title+"</option>"}),$.each(widget_places,function(t,a){var i="dm-edit-homescreen-"+a,n='<div data-role="fieldcontain">';n+='<label for="'+i+'-select">Widget&nbsp;'+a.toUpperCase()+":</label><br>",n+='<select data-native-menu="true" name="'+i+'" id="'+i+'-select">',n+=e,n+="</select>",n+="</div>",$("#dm-edit-widget-place-"+a).html(n)}),$.each(widgets,function(e,t){$("#dm-edit-widget-place-"+t.place+" option").filter('[value="'+t.fnc+'"]').prop("selected",!0)}),!1}function saveHomescreen(){widgets=[],$.each(widget_places,function(e,t){var a="dm-edit-homescreen-"+t,i=$("#"+a+"-select option:selected").val(),n={place:t,fnc:i,options:{}};widgets.push(n)}),simpleStorage.set("dm-widgets",widgets),showHome()}function countUnreadItems(){return unread_counter={},dbgMsg("counting unread items"),$.each(items,function(e,t){0==t.is_read&&(unread_counter["feed-"+t.feed_id]?unread_counter["feed-"+t.feed_id]++:unread_counter["feed-"+t.feed_id]=1)}),!0}function getUnreadCountFeed(e){var t=unread_counter["feed-"+e];
return t?unread_counter["feed-"+e]:0}function exportSettings(){var e={};return $("#dm-export-fav").is(":checked")&&(e.fav_feeds=fav_feeds,e.fav_groups=fav_groups),$("#dm-export-homescreen").is(":checked")&&(e.widgets=widgets),$("#dm-export-settings").is(":checked")&&(e.config=dm_config),LZString.compressToEncodedURIComponent(JSON.stringify(e))}function saveImportedSettings(e){dbgMsg("saveImportedSettings()"),dbgMsg(e),_.isUndefined(e.widgets)||(dbgMsg("Import a new Layout"),simpleStorage.set("dm-widgets",e.widgets),widgets=e.widgets),_.isUndefined(e.config)||(dbgMsg("Import new settings"),e.config.url=getOption("url"),e.config.key=getOption("key"),e.config.user=getOption("user"),dbgMsg(e.config),simpleStorage.set("dm-config",e.config),dm_config=e.config),_.isUndefined(e.fav_feeds)||(dbgMsg("Import Fav Feeds"),simpleStorage.set("dm-fav-feeds",e.fav_feeds),fav_feeds=e.fav_feeds),_.isUndefined(e.fav_groups)||(dbgMsg("Import Fav Groups"),simpleStorage.set("dm-fav-groups",e.fav_groups),fav_groups=e.fav_groups)}function showImportExport(){var e=exportSettings();$("#dm-export-settings-box").val(e)}function importSettings(){if($("#dm-import-settings").val()){{JSON.parse(LZString.decompressFromEncodedURIComponent($("#dm-import-settings").val()))}saveImportedSettings()}getSettings(),runAfterItemLoadNoHome(),storeLoadedSavedItems(),$.mobile.navigate("#page-home",{transition:transition})}function generateExportFile(){var e=exportSettings(),t=new Blob([e],{type:"application/octet-stream"});saveAs(t,"settings.dm")}function autoSync(){switch(dbgMsg("starting autosync"),syncGroups(),syncFeeds(),syncSavedItems("sync"),syncUnreadItems("sync"),dbgMsg("Current Page: "+getCurrentPageID()),getCurrentPageID()){case"page-home":prepareHome()}return!1}function syncItems(){return autoSync(),!1}function syncUnreadItems(e){return last_dm_refresh=now(),"full"==e?void refreshItems():(showHideLoader("start"),void $.post(dm_url+"?api&unread_item_ids",{api_key:dm_key}).done(function(e){if(showHideLoader("stop"),checkAuth(e.auth)){var t=!1,a=e.unread_item_ids.split(",");last_fever_refresh=e.last_refreshed_on_time;var i=[];$.each(items,function(e,t){i.push(t.id.toString())});var n=_.difference(a,i),s=_.difference(i,a);n.length>0?(afterItemLoad=_.after(n.length,runAfterItemLoad),loadItems(n)):t=!0,s.length>0?(items=_.reject(items,function(e){return-1==$.inArray(e.id.toString(),s)?!1:!0}),t=!0):t=!0,1==t&&runAfterItemLoad()}}).fail(function(){showHideLoader("stop"),checkAuth(0)}))}function refreshItems(){showHideLoader("start"),$.post(dm_url+"?api&unread_item_ids",{api_key:dm_key}).done(function(e){if(showHideLoader("stop"),checkAuth(e.auth)){var t=e.unread_item_ids.split(",");t=_.compact(t),items=[],0==t.length?(last_fever_refresh=e.last_refreshed_on_time,runAfterItemLoad()):(afterItemLoad=_.after(t.length,runAfterItemLoad),loadItems(t))}}).fail(function(){showHideLoader("stop"),checkAuth(0)})}function loadItems(e){if(e.length>50)var t=_.first(e,50),a=_.rest(e,50);else var t=e,a=[];var i=t.join(",");showHideLoader("start"),$.post(dm_url+"?api&items&with_ids="+_.escape(i),{api_key:dm_key}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)&&(last_fever_refresh=e.last_refreshed_on_time,$.each(e.items,function(e,t){items.push(t),afterItemLoad()}))}),a.length>0?loadItems(a):runAfterItemLoad()}function runAfterItemLoad(){runAfterItemLoadNoHome(),prepareHome()}function runAfterItemLoadNoHome(){return dbgMsg("Finished items load"),items=_.sortBy(items,"created_on_time"),items=_.uniq(items),"desc"==getOption("order_items")&&items.reverse(),items_loaded=!0,!0}function markItemsRead(e){var t;_.isArray(e)?t=e:(e=getString(e),t=_.compact(e.split(",")),_.isArray(t)!==!0&&(t=[e]));var a=[];a=_.reject(items,function(e){return-1==$.inArray(e.id.toString(),t)?!0:!1}),$.each(a,function(e,t){t.is_read=1,session_read_items.push(t)}),items=_.reject(items,function(e){return-1==$.inArray(e.id.toString(),t)?!1:!0}),$.each(t,function(e,t){markItemRead(t)})}function markItemRead(e){""!=$.trim(e)&&($(".dm-single-item-link-"+e).removeClass("dm-item-is-unread").addClass("dm-item-is-read"),showHideLoader("start"),$.post(dm_url+"?api",{api_key:dm_key,mark:"item",as:"read",id:$.trim(_.escape(e))}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)}).fail(function(){showHideLoader("stop"),checkAuth(0)}))}function markKindlingRead(){$.each(items,function(e,t){t.is_read=1,session_read_items.push(t)}),items=[],showHideLoader("start"),$.post(dm_url+"?api",{api_key:dm_key,mark:"group",as:"read",id:0,before:last_dm_group_show}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)&&(syncItems(),window.history.back())}).fail(function(){showHideLoader("stop"),checkAuth(0)})}function markAllRead(){$.each(items,function(e,t){t.is_read=1,session_read_items.push(t)}),items=[],showHideLoader("start"),$.post(dm_url+"?api",{api_key:dm_key,mark:"group",as:"read",id:0,before:last_dm_group_show}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)&&syncItems()}).fail(function(){showHideLoader("stop"),checkAuth(0)})}function markGroupAsRead(e){return $("#dm-group-content").removeData("dm-current-group-id"),markGroupRead("group",getNumber(e)),window.history.back(),!1}function markGroupRead(e,t){dbgMsg(e+" :"+t);var a;if("feed"==e&&(a=[getString(t)]),"group"==e){dbgMsg(feeds_groups);var i=_.findWhere(feeds_groups,{group_id:getNumber(t)});a=i.feed_ids.split(",")}a=_.compact(a);var n=[];n=_.reject(items,function(e){return-1==$.inArray(e.feed_id.toString(),a)?!0:!1}),$.each(n,function(e,t){t.is_read=1,session_read_items.push(t)}),items=_.reject(items,function(e){return-1==$.inArray(e.feed_id.toString(),a)?!1:!0}),""!=$.trim(t)&&(showHideLoader("start"),$.post(dm_url+"?api",{api_key:dm_key,mark:e,as:"read",id:$.trim(_.escape(t)),before:last_dm_group_show}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)}).fail(function(){showHideLoader("stop"),checkAuth(0)})),runAfterItemLoadNoHome()}function saveItem(e){if(""!=$.trim(e)){dbgMsg("Save: "+e);var t=_.findWhere(items,{id:e});t||(t=_.findWhere(session_read_items,{id:e})),t&&(t.is_saved=1,t.html="",t.url="",saved_items.push(t),storeLoadedSavedItems(),showHideLoader("start"),$.post(dm_url+"?api",{api_key:dm_key,mark:"item",as:"saved",id:$.trim(_.escape(e))}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)}).fail(function(){showHideLoader("stop"),checkAuth(0),dbgMsg("Save fail")}))}}function unsaveItem(e){if(""!=$.trim(e)){var t=e,a=_.findWhere(saved_items,{id:e});a.id_saved=0,saved_items=_.reject(saved_items,function(e){return e.id!=t?!1:!0}),storeLoadedSavedItems(),showHideLoader("start"),$.post(dm_url+"?api",{api_key:dm_key,mark:"item",as:"unsaved",id:$.trim(_.escape(e))}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)}).fail(function(){showHideLoader("stop"),checkAuth(0)})}}function isItemSaved(e){var t=_.findWhere(saved_items,{id:e});return t?!0:!1}function toggleSaveState(e){isItemSaved(e)?saveCurrentItem(e):unsaveCurrentItem(e)}function saveCurrentItem(e){return saveItem(e),!1}function unsaveCurrentItem(e){return unsaveItem(e),!1}function markFeedAsRead(e,t){return $("#dm-feed-content").removeData("dm-feed-item-ids"),$("#dm-feed-content").removeData("dm-feed-id"),markGroupRead("feed",getNumber(e),t),window.history.back(),!1}function refreshFavicons(){return showHideLoader("start"),$.post(dm_url+"?api&favicons",{api_key:dm_key}).done(function(e){if(showHideLoader("stop"),checkAuth(e.auth)){favicons=e.favicons;var t=simpleStorage.set("dm-favicons",favicons);dbgMsg("Message from saving faviocons -> Favicons: "+favicons.length),dbgMsg(t),feed_counter=feeds.length,simpleStorage.set("dm-feed-counter",feed_counter)}}).fail(function(){showHideLoader("stop"),checkAuth(0)}),!1}function syncGroups(){showHideLoader("start"),$.post(dm_url+"?api&groups",{api_key:dm_key}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)&&(groups=_.sortBy(e.groups,"title"),groups.sort(function(e,t){var a=e.title.toLowerCase(),i=t.title.toLowerCase();return i>a?-1:a>i?1:0}),feeds_groups=e.feeds_groups,prepareHome())}).fail(function(){showHideLoader("stop"),checkAuth(0)})}function syncFeeds(){showHideLoader("start"),$.post(dm_url+"?api&feeds",{api_key:dm_key}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)&&(feeds=e.feeds,feeds.sort(function(e,t){var a=e.title.toLowerCase(),i=t.title.toLowerCase();return i>a?-1:a>i?1:0}),feeds.length!==getNumber(feed_counter)?(dbgMsg("Feeds: "+feeds.length+", Counter: "+feed_counter+", Favicons: "+favicons.length),refreshFavicons()):(dbgMsg("All favicons are here because:"),dbgMsg("Feeds: "+feeds.length+", Counter: "+feed_counter+", Favicons: "+favicons.length)),prepareHome())}).fail(function(){showHideLoader("stop"),checkAuth(0)})}function checkAuth(e){return 1==e?!0:(1==auth_success?dbgMsg("Probably stopped or network issue."):$.mobile.navigate("#page-login",{transition:transition}),!1)}function unreadLastItems(){showHideLoader("start"),$.post(dm_url+"?api",{api_key:dm_key,unread_recently_read:"1"}).done(function(){showHideLoader("stop")}).fail(function(){showHideLoader("stop"),checkAuth(0)})}function syncSavedItems(e){return"full"==e?void refreshSavedItems():(showHideLoader("start"),void $.post(dm_url+"?api&saved_item_ids",{api_key:dm_key}).done(function(e){if(showHideLoader("stop"),checkAuth(e.auth)){dbgMsg("Saved items: "+e.saved_item_ids);var t=e.saved_item_ids.split(",");if(0==saved_items.length&&t.length>0)dbgMsg("Saved items: Load all saved items"),refreshSavedItems();else{dbgMsg("Saved items: Sync saved items");var a=[];$.each(saved_items,function(e,t){a.push(t.id.toString())});var i=_.difference(t,a),n=_.difference(a,t);n.length>0?(saved_items=_.reject(saved_items,function(e){return-1==$.inArray(e.id.toString(),n)?!1:!0}),dbgMsg("Saved items: Deleted "+n.length+" saved items."),storeLoadedSavedItems()):dbgMsg("Saved items: Nothing to delete."),i.length>0?(dbgMsg("Saved items: Load "+i.length+" items"),processLoadedSaveItems=_.after(i.length,storeLoadedSavedItems),loadSavedItems(i)):dbgMsg("Saved items: Nothing to load.")}}}).fail(function(){showHideLoader("stop"),checkAuth(0)}))}function loadSavedItems(e){if(e.length>50)var t=_.first(e,50),a=_.rest(e,50);else var t=e,a=[];var i=t.join(",");showHideLoader("start"),$.post(dm_url+"?api&items&with_ids="+i,{api_key:dm_key}).done(function(e){showHideLoader("stop"),checkAuth(e.auth)&&$.each(e.items,function(e,t){t.html="",t.url="",saved_items.push(t),processLoadedSaveItems()})}).fail(function(){showHideLoader("stop"),checkAuth(0)}),a.length>0&&loadSavedItems(a)}function storeLoadedSavedItems(){saved_items=_.sortBy(saved_items,"created_on_time"),"desc"==getOption("order_items")&&saved_items.reverse(),dbgMsg("storeLoadedSavedItems(): store "+saved_items.length+" saved items");var e=JSON.stringify(saved_items);dbgMsg("Raw size: "+e.length);var t=LZString.compressToUTF16(e);dbgMsg("Compressed size: "+t.length);var a=simpleStorage.set("dm-saved-items",t);dbgMsg(a),prepareHome()}function refreshSavedItems(){showHideLoader("start"),$.post(dm_url+"?api&saved_item_ids",{api_key:dm_key}).done(function(e){if(showHideLoader("stop"),checkAuth(e.auth)&&(dbgMsg("refreshSavedItems(): Clearing saved items."),simpleStorage.set("dm-saved-items",[]),saved_items=[],""!=e.saved_item_ids)){var t=e.saved_item_ids.split(",");processLoadedSaveItems=_.after(t.length,storeLoadedSavedItems),loadSavedItems(t)}}).fail(function(){showHideLoader("stop"),checkAuth(0)})}function parseWidget(e){return'<div class="dm-widget-container">'+e+"</div>"}function widgetEmpty(){return""}function widgetSystemGroups(){var e="";e+='<h2>Fever<span style="color:red">°</span> Groups</h2>',e+='<ul data-role="listview" data-theme="a" data-inset="true">',e+='<li><a href="" class="dm-button" data-dm-fnc="show-hot">Hot</a></li>',e+='<li><a href="" class="dm-button" data-dm-fnc="show-kindling">Kindling';var t=_.where(items,{is_read:0});e+='<span class="ui-li-count">'+t.length+"</span></a></li>",e+='<li><a href="" class="dm-button" data-dm-fnc="show-sparks">Sparks';var a=getUnreadSparks();return e+='<span class="ui-li-count">'+a.counter+"</span></a></li>",e+='<li><a href="" class="dm-button" data-dm-fnc="show-saved">Saved Items',e+='<span class="ui-li-count">'+saved_items.length+"</span></a></li>",e+='<li><a href="" class="dm-button" data-dm-fnc="show-all-feeds">All Feeds',e+='<span class="ui-li-count">'+_.size(feeds)+"</span></a></li>",e+="</ul>",e+='<p>Last Fever<span style="color:red">°</span> Refresh @ '+renderDate("time",last_fever_refresh)+"</p>",parseWidget(e)}function widgetCustomGroups(){var e="<h2>My Groups</h2>";return e+='<ul data-role="listview" data-filter-theme="a" data-divider-theme="a" data-theme="a" data-inset="true" data-filter="true" id="dm-groups" class="dm-home-views">',$.each(groups,function(t,a){var i=countUnreadInGroup(a.id);0===i?getOption("show_empty_groups")===!0&&(e+='<li id="dm-group-'+a.id+'">',e+='<a href="" class="dm-button" data-dm-fnc="show-group-selector" data-dm-show-group="'+_.escape(a.id)+'">',e+=_.escape(a.title),e+='<span class="ui-li-count">'+i+"</span></a></li>"):(e+='<li id="dm-group-'+a.id+'"><a href="" class="dm-button" data-dm-fnc="show-group-selector" data-dm-show-group="'+_.escape(a.id)+'">'+_.escape(a.title),e+='<span class="ui-li-count">'+i+"</span></a></li>")}),e+="</ul>",parseWidget(e)}function widgetHotView(){return""}function widgetShowGroup(){return""}function widgetShowFavGroups(){var e="";return $.each(groups,function(t,a){if(_.contains(fav_groups,a.id)){var i=countUnreadInGroup(a.id);if(i>0){var n=_.findWhere(groups,{id:a.id});e+='<li data-theme="a">',e+='<a href="" data-dm-show-group="'+n.id+'" class="dm-button" data-dm-fnc="show-group-selector">'+_.escape(n.title),e+='<span class="ui-li-count">'+i+"</span></a></li>"}}}),e?(e='<ul data-role="listview" data-theme="a" data-inset="true">'+e,e+="</ul>"):e="<p>No new items in your favourite groups.</p>",parseWidget("<h2>Favourite Groups</h2>"+e)}function widgetShowFavFeeds(){var e="";countUnreadItems();var t="";return $.each(feeds,function(e,a){if(_.contains(fav_feeds,a.id)){var i=_.findWhere(feeds,{id:getNumber(a.id)});t+=renderListviewItemFeed(i,!1)}}),e=t?'<h2>Favourite Feeds</h2><ul data-role="listview" data-theme="a" data-inset="true">'+t+"</ul>":"<h2>Favourite Feeds</h2><p>No new items in your favourite feeds.</p>",parseWidget(e)}function widgetFavFeedsLastItems(){var e=_.filter(items,function(e){return _.contains(fav_feeds,e.feed_id)?!0:!1});if("asc"===getOption("order_items")){var t=_.last(e,getNumber(getOption("widget_recent_items")));t.reverse()}else var t=_.first(e,getNumber(getOption("widget_recent_items")));if(t.length>0){var a='<h2>Recent Favourite Items</h2><ul data-role="listview" data-divider-theme="a" data-inset="true">',i=[];return $.each(t,function(e,t){i.push(t.id),a+=renderListviewItem(t,!0,!0,"long")}),a+="</ul>",a+='<a href="" data-role="button" class="dm-button"  data-dm-fnc="mark-read-recent-fav-items" data-dm-item-ids="'+i.join(",")+'">Mark Items Read</a>',parseWidget(a)}return parseWidget("<h2>Recent Favourite Items</h2><p>No new items in favourite feeds.</p>")}function widgetLastSavedItems(){if("asc"===getOption("order_items")){var e=_.last(saved_items,getNumber(getOption("widget_recent_items")));e.reverse()}else var e=_.first(saved_items,getNumber(getOption("widget_recent_items")));if(e.length>0){var t='<h2>Recent Saved Items</h2><ul data-role="listview" data-divider-theme="a" data-inset="true">',a=[];return $.each(e,function(e,i){a.push(i.id),t+=renderListviewItem(i,!0,!0,"long")}),t+="</ul>",parseWidget(t)}return parseWidget("<h2>Recent Saved Items</h2><p>No saved items</p>")}function widgetDebug(){var e="<h2>Debug info</h2>";e+="Storage available: "+simpleStorage.canUse()+"<br>",e+="Storage used: "+simpleStorage.storageSize()/1024+" kB<br>";var t=simpleStorage.index();return $.each(t,function(t,a){e+="Key: "+a+"<br>"}),parseWidget(e)}function widgetButtonSparks(){return parseWidget('<a href="" data-role="button" class="dm-button"  data-dm-fnc="show-sparks">Show Sparks</a>')}function widgetButtonKindling(){return parseWidget('<a href="" data-role="button" class="dm-button" data-dm-fnc="show-kindling">Show Kindling</a>')}function widgetButtonSaved(){return parseWidget('<a href="" data-role="button" class="dm-button" data-dm-fnc="show-saved">Show Saved</a>')}function widgetButtonHotView(){return parseWidget('<a href="" data-role="button" class="dm-button" data-dm-fnc="show-hot">Show Hot Items</a>')}function widgetButtonAllFeeds(){return parseWidget('<a href="" data-role="button" class="dm-button" data-dm-fnc="show-all-feeds">Show All Feeds</a>')}function widgetButtonGroups(){return parseWidget('<a href="" data-role="button" class="dm-button" data-dm-fnc="show-groups">Show Groups</a>')}function widgetButtonSettings(){return parseWidget('<a href="#page-settings" data-icon="gear" data-role="button">Edit Settings</a>')}function widgetButtonReloadFavicons(){return parseWidget('<a href="" data-role="button" data-icon="refresh" class="dm-button" data-dm-fnc="refresh-favicons">Reload Favicons</a>')}function widgetButtonEditHomescreen(){return parseWidget('<a href="" data-role="button" data-icon="grid" class="dm-button" data-dm-fnc="show-edit-homescreen">Edit Homescreen</a>')}function widgetButtonSyncItems(){return parseWidget('<a href="" data-role="button" data-icon="refresh" class="dm-button" data-dm-fnc="sync-items">Sync with Fever<span style="color:red;">°</span></a>')}function widgetButtonMarkAllRead(){return parseWidget('<a href="" data-role="button" data-icon="check" class="dm-button" data-dm-fnc="mark-all-read">Mark all Read</a>')}function widgetButtonUnreadLastItems(){return parseWidget('<a href="" data-role="button" data-icon="eye" class="dm-button" data-dm-fnc="unread-last-items">Mark Last Items Unread</a>')}function widgetButtonLogout(){return parseWidget('<a href="" data-role="button" data-icon="power" data-theme="d" class="dm-button" data-dm-fnc="logout">Logout</a>')}function registerEventHandlers(){$(document).on("pagecreate",".dm-page",function(){}),$(document).on("pageinit",".dm-page",function(){}),$(document).on("pageshow",function(e){$(this).enhanceWithin();try{$(".dm-toolbar").toolbar("updatePagePadding")}catch(e){console.log(e)}}),$(document).on("pagebeforeshow",".dm-page",function(e,t){var a=$(this).attr("id");if(_.isUndefined($(t.prevPage).attr("id"))){if(dbgMsg("prev page is empty, startup assumed"),"page-home"===a)return void dbgMsg("was in pagebeforeshow for "+a);dbgMsg("show home instead"),""!==dm_url&&"page-settings"!==a&&showHome()}else dbgMsg("from: "+$(t.prevPage).attr("id"));switch(dbgMsg("pagebeforeshow: "+$(this).attr("id")),a){case"page-home":prepareHome();break;case"page-settings":initSettings();break;case"page-all-feeds":showAllFeeds();break;case"page-saved":showSaved();break;case"page-groups":showGroups();break;case"page-edit-homescreen":showEditHomescreen();break;case"page-feedgroup":var a=$(this).data("dm-group-id");showFeedsInGroup(a);break;case"page-single":break;case"page-login":auth_success===!0?$.mobile.navigate("#page-home",{transition:transition}):simpleStorage.flush();break;case"page-importexport":showImportExport()}$(this).enhanceWithin()}),$(document).on("vclick",".dm-popup-button",function(){$("#dm-home-popup").popup("close")}),$(document).on("vclick",".dm-button",function(e){e.preventDefault();var t=$(this).data("dm-fnc");switch(dbgMsg("vclick button: "+t),t){case"show-item":var a=$(this).data("dm-show-item");showSingleItem(a),$.mobile.navigate("#page-single",{transition:transition});break;case"show-group":var a=$(this).data("dm-show-group");showGroup(a),$.mobile.navigate("#page-group",{transition:transition});break;case"show-group-selector":var a=$(this).data("dm-show-group");"feeds"==getOption("groupview")?($("#page-feedgroup").data("dm-group-id",a),$.mobile.navigate("#page-feedgroup",{transition:transition})):(showGroup(a),$.mobile.navigate("#page-group",{transition:transition}));break;case"show-feed":var a=$(this).data("dm-show-feed");$("#page-feed").data("dm-show-feed-id",a),showFeed(a),$.mobile.navigate("#page-feed",{transition:transition});break;case"show-all-feeds":$.mobile.navigate("#page-all-feeds",{transition:transition});break;case"show-hot":showHot(1),$.mobile.navigate("#page-hot",{transition:transition});break;case"show-hot-more":var i=$(this).data("dm-hot-page");i++,$(this).data("dm-hot-page",i),showHot(i);break;case"show-kindling-more":markItemsRead($(this).data("dm-ids"));{$(this).data("dm-ids")}buildKindling(),$("#page-kindling").enhanceWithin(),$.mobile.silentScroll(0);break;case"show-group-more":markItemsRead($(this).data("dm-item-ids")),buildGroup($(this).data("dm-group-id")),$("#page-group").enhanceWithin(),$.mobile.silentScroll(0);break;case"show-feed-more":markItemsRead($(this).data("dm-item-ids")),buildFeed($(this).data("dm-feed-id")),$("#page-feed").enhanceWithin(),$.mobile.silentScroll(0);break;case"show-home":showHome();break;case"to-top":$.mobile.silentScroll(0);break;case"back":window.history.back();break;case"show-groups":$.mobile.navigate("#page-groups",{transition:transition});break;case"sync-items":syncItems();break;case"show-sparks":showSparks();break;case"show-kindling":showKindling(),$.mobile.navigate("#page-kindling",{transition:transition});break;case"refresh-favicons":refreshFavicons();break;case"refresh-saved-items":refreshSavedItems();break;case"refresh-items":refreshItems();break;case"show-edit-homescreen":$.mobile.navigate("#page-edit-homescreen",{transition:transition});break;case"show-saved":$.mobile.navigate("#page-saved",{transition:transition});break;case"mark-items-read":var n=$(this).data("dm-item-ids");markItemsRead(n);break;case"mark-kindling-read":markKindlingRead();break;case"mark-all-read":markAllRead();break;case"mark-group-read":var s=$(this).data("dm-group-id");markGroupAsRead(s,n);break;case"mark-feed-read":var n=$(this).data("dm-item-ids"),d=$(this).data("dm-feed-id");markFeedAsRead(d,n);break;case"mark-read-recent-fav-items":var n=$(this).data("dm-item-ids");markItemsRead(n),showHome();break;case"toggle-group-fav":case"mark-group-fav":markGroupAsFav();break;case"toggle-feed-fav":case"mark-feed-fav":markFeedAsFav();break;case"save-settings":saveSettings();break;case"save-homescreen":saveHomescreen();break;case"logout":confirm("Logout deletes all your data and connot be undone. Are you sure?")&&logout();break;case"toggle-save-item":case"save-item":var a=$(this).data("dm-save-item-id");a=getNumber(a);var r=isItemSaved(a);r?($(this).text("Save"),$(this).buttonMarkup({icon:"plus"}),unsaveCurrentItem(a)):($(this).text("Unsave"),$(this).buttonMarkup({icon:"minus"}),saveCurrentItem(a));break;case"show-feeds-group":var a=$(this).data("dm-group-id");$("#page-feedgroup").data("dm-group-id",a),$.mobile.navigate("#page-feedgroup",{transition:transition});break;case"unread-last-items":unreadLastItems(),syncItems(),showHome();break;case"show-saved-time":showSavedByTimePage(1),$("#page-saved").enhanceWithin();break;case"show-saved-feed":showSavedByFeed(),$("#page-saved").enhanceWithin();break;case"login":login();break;case"import-settings":importSettings();break;case"download-settings":generateExportFile();break;case"upload-settings":importSettingsFile();break;case"show-saved-page":var o=$(this).data("dm-saved-page");showSavedByTimePage(getNumber(o)),$("#page-saved").enhanceWithin()}}),$(document).ready(function(){$("#dm-settings-file-import").change(function(e){var t=e.target.files[0];if(t){var a=new FileReader;a.onload=function(e){var t=e.target.result;saveImportedSettings(JSON.parse(LZString.decompressFromEncodedURIComponent(t))),getSettings(),runAfterItemLoadNoHome(),storeLoadedSavedItems(),$.mobile.navigate("#page-home",{transition:transition})},a.readAsText(t)}}),$(".dm-export-box").change(function(){showImportExport()})})}var dm_key,dm_url,dm_user,groups=[],feeds=[],feeds_groups=[],favicons=[],widget_recent_items=10,items=[],saved_items=[],session_read_items=[],unread_counter={},items_loaded=!1,started_items_load=!1,feeds_hash="none",feed_counter=0,fav_groups=[],fav_feeds=[],dm_autosync,default_widgets=[{place:"a1",fnc:"widgetButtonHotView",options:{}},{place:"b1",fnc:"widgetButtonSaved",options:{}},{place:"a2",fnc:"widgetShowFavFeeds",options:{}},{place:"b2",fnc:"widgetShowFavGroups",options:{}},{place:"a3",fnc:"widgetSystemGroups",options:{}},{place:"b3",fnc:"widgetCustomGroups",options:{}},{place:"a4",fnc:"widgetButtonKindling",options:{}},{place:"b4",fnc:"widgetButtonSparks",options:{}},{place:"a5",fnc:"widgetButtonReloadFavicons",options:{}},{place:"b5",fnc:"widgetButtonSettings",options:{}},{place:"a6",fnc:"widgetButtonEditHomescreen",options:{}},{place:"b6",fnc:"widgetButtonLogout",options:{}}],widgets=[],dm_config={url:"",key:"",user:"",transition:"slide",html_content:"escape",show_empty_groups:!1,sharing:"email",sharing_mobile:!0,sharing_msg:"Check out this nice article I found: %url%",order_items:"asc",groupview:"items",paginate_items:100,widget_recent_items:10},transition="slide",started=!1,dm_data={feed_counter:0,feeds_hash:"none",favicons:[]},loading=0,auth_success=!1,last_dm_refresh=0,last_fever_refresh=0,last_dm_group_show=now();$(document).bind("mobileinit",function(){dbgMsg("mobilestart"),getSettings(),registerEventHandlers(),start()});var afterItemLoad,processLoadedSaveItems,widget_places=["a1","b1","a2","b2","a3","b3","a4","b4","a5","b5","a6","b6","a7","b7","a8","b8","a9","b9"],defined_widgets=[{fnc:"widgetButtonHotView",title:"Button: Show Hot Items",desc:""},{fnc:"widgetButtonSaved",title:"Button: Show Saved Items",desc:""},{fnc:"widgetButtonKindling",title:"Button: Show Kindling Items",desc:""},{fnc:"widgetButtonSparks",title:"Button: Show Sparks",desc:""},{fnc:"widgetButtonAllFeeds",title:"Button: Show All Feeds",desc:""},{fnc:"widgetButtonGroups",title:"Button: Show Groups",desc:""},{fnc:"widgetButtonReloadFavicons",title:"Button: Reload Favicons",desc:""},{fnc:"widgetButtonSettings",title:"Button: Show Settings",desc:""},{fnc:"widgetButtonEditHomescreen",title:"Button: Edit Homescreen",desc:""},{fnc:"widgetButtonSyncItems",title:"Button: Sync Items",desc:""},{fnc:"widgetButtonMarkAllRead",title:"Button: Mark all read",desc:""},{fnc:"widgetButtonUnreadLastItems",title:"Button: Last items unread",desc:""},{fnc:"widgetButtonLogout",title:"Button: Logout",desc:""},{fnc:"widgetShowFavFeeds",title:"Show Favourite Feeds",desc:""},{fnc:"widgetShowFavGroups",title:"Show Favourite Groups",desc:""},{fnc:"widgetFavFeedsLastItems",title:"Recent Favourite Items",dec:""},{fnc:"widgetLastSavedItems",title:"Recent Saved Items",dec:""},{fnc:"widgetDebug",title:"Debug Infos",dec:""},{fnc:"widgetSystemGroups",title:"Show System Groups",desc:""},{fnc:"widgetCustomGroups",title:"Show Custom Groups",desc:""}];